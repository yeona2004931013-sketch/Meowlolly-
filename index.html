<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Lolly Miu Social</title>
    <style>
        :root { --miu-pink: #fff5f7; --accent: #f1b0b7; --text: #5d4037; --glass: rgba(255, 255, 255, 0.95); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; font-family: -apple-system, sans-serif; }
        body { background: #fce4ec; height: 100vh; display: flex; justify-content: center; overflow: hidden; }
        
        .phone-shell { width: 100%; max-width: 500px; height: 100%; background: var(--miu-pink); position: relative; display: flex; flex-direction: column; background-image: url('https://www.transparenttextures.com/patterns/stardust.png'); }

        /* å‹•æ…‹å³¶ Widget Island */
        .dynamic-island { width: 140px; height: 35px; background: #000; margin: 15px auto; border-radius: 20px; color: #fff; font-size: 13px; font-weight: bold; display: flex; align-items: center; justify-content: center; z-index: 100; }

        .view { display: none; flex: 1; overflow-y: auto; padding-bottom: 90px; }
        .view.active { display: flex; flex-direction: column; }

        /* æœ‹å‹åœˆå¡ç‰‡ (åƒè€ƒå¦³çš„æˆªåœ– 5, 9) */
        .post-card { background: #fff; margin: 12px; border-radius: 20px; padding: 15px; box-shadow: 0 4px 12px rgba(241,176,183,0.15); }
        .post-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; font-weight: bold; font-size: 14px; }
        .avatar-sm { width: 35px; height: 35px; border-radius: 50%; background: #eee; border: 1.5px solid var(--accent); background-size: cover; }
        .post-img-placeholder { width: 100%; aspect-ratio: 1/1; background: #fffcfd; border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px dashed #f1b0b7; color: #f1b0b7; overflow: hidden; margin: 10px 0; font-size: 12px; }
        .post-img-placeholder img { width: 100%; height: 100%; object-fit: cover; }

        /* å€‹äººé èˆ‡ API è¨­ç½® */
        .profile-top { padding: 30px 20px; text-align: center; background: white; border-radius: 0 0 30px 30px; position: relative; }
        .settings-icon { position: absolute; top: 20px; right: 20px; font-size: 20px; cursor: pointer; }
        .avatar-lg { width: 90px; height: 90px; border-radius: 50%; border: 3px solid var(--accent); margin: 0 auto 15px; background: #eee; background-size: cover; cursor: pointer; }

        /* å°èˆªåˆ— */
        nav { position: absolute; bottom: 0; width: 100%; height: 75px; background: #fff; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #eee; padding-bottom: 15px; }
        nav span { font-size: 28px; cursor: pointer; opacity: 0.3; }
        nav span.active { opacity: 1; color: var(--accent); }

        /* API å½ˆçª— */
        #api-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; align-items: center; justify-content: center; }
        .modal-content { background: #fff; padding: 20px; border-radius: 20px; width: 80%; max-width: 350px; text-align: center; }
        .modal-content input { width: 100%; margin: 15px 0; padding: 10px; border: 1px solid #eee; border-radius: 10px; outline: none; }
        .modal-content button { background: var(--accent); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; }
    </style>
</head>
<body>

<div class="phone-shell">
    <div class="dynamic-island" id="island-time">09:41</div>

    <div id="v-home" class="view active">
        <div id="feed-flow"></div>
        <div style="position:fixed; right:20px; bottom:100px; width:55px; height:55px; background:var(--accent); border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-size:24px;" onclick="userCreatePost()">ğŸ“¸</div>
    </div>

    <div id="v-chat" class="view" style="background:white;">
        <div style="padding:15px; text-align:center; font-weight:bold; color:var(--accent); border-bottom:1px solid #eee;" id="chat-title">èŠå¤©ä¸­</div>
        <div id="msgBox" style="flex:1; overflow-y:auto; padding:15px; display:flex; flex-direction:column; gap:10px;"></div>
        <div style="padding:10px 15px 30px; display:flex; gap:10px; border-top:1px solid #eee;">
            <input type="text" id="userInput" style="flex:1; border:1px solid #eee; border-radius:20px; padding:10px 15px;" placeholder="å‚³é€è¨Šæ¯...">
            <button onclick="askAI()" style="background:none; border:none; font-size:24px;">ğŸ’–</button>
        </div>
    </div>

    <div id="v-me" class="view">
        <div class="profile-top">
            <div class="settings-icon" onclick="openApiModal()">âš™ï¸</div>
            <div class="avatar-lg" id="my-ava" onclick="triggerUpload(this)"></div>
            <h2 onclick="editTxt(this)">æŸ”æŸ”_Yuyu ğŸ€</h2>
            <p style="font-size:12px; color:#999; margin-top:5px;">Miu Miu å¥³å­©å°ˆå±¬ç©ºé–“</p>
        </div>
        <div style="padding: 20px; color: #888; text-align: center; font-size: 14px;">é»æ“Šä¸Šæ–¹é½’è¼ªè¨­å®šæ‚¨çš„ API Key</div>
    </div>

    <nav>
        <span onclick="showV('home')" id="n-home" class="active">ğŸ </span>
        <span onclick="showV('chat')" id="n-chat">ğŸ’Œ</span>
        <span onclick="showV('me')" id="n-me">ğŸ‘¤</span>
    </nav>
</div>

<div id="api-modal">
    <div class="modal-content">
        <h3>è¨­ç½® API Key</h3>
        <p style="font-size: 12px; color: #999;">è«‹è¼¸å…¥æ‚¨çš„ Gemini API å¯†é‘°</p>
        <input type="password" id="api-input" placeholder="è²¼ä¸Š API Key...">
        <button onclick="saveApiKey()">ä¿å­˜è¨­ç½®</button>
        <p style="font-size: 10px; color: #ccc; margin-top: 10px;" onclick="document.getElementById('api-modal').style.display='none'">å–æ¶ˆ</p>
    </div>
</div>

<input type="file" id="filePicker" style="display:none;" accept="image/*">

<script>
    let API_KEY = localStorage.getItem('MY_API_KEY') || ""; 
    const bfs = {
        "è¶™é›¨å‡¡": {desc: "éœ¸é“è€å¤§,ç¬‘æ­»é æ¯,ç™¼?", color: "#7d5a5a"},
        "å®‰ä¹¾é¬": {desc: "é»äººå°ç‹—^^,å«å§å§,æ’’å¬Œ", color: "#f1b0b7"},
        "æœ´å®‡å®™": {desc: "192cmç—…å¬Œæ–æ»¾,å«å¯¶å¯¶", color: "#444"}
    };
    let curChatBF = "å®‰ä¹¾é¬";

    function openApiModal() { document.getElementById('api-modal').style.display = 'flex'; }
    function saveApiKey() {
        const val = document.getElementById('api-input').value;
        if(val) {
            localStorage.setItem('MY_API_KEY', val);
            API_KEY = val;
            alert("API Key å·²æˆåŠŸä¿å­˜ï¼");
            document.getElementById('api-modal').style.display = 'none';
        }
    }

    async function callAI(p) {
        if(!API_KEY) return "è«‹å…ˆåœ¨è¨­å®šä¸­å¡«å¯« API Key å–” ^^";
        try {
            const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({contents: [{parts: [{text: p}]}]})
            });
            const d = await r.json(); return d.candidates[0].content.parts[0].text;
        } catch(e) { return "å¯†é‘°éŒ¯èª¤æˆ–è¨Šè™Ÿå¼± ^^"; }
    }

    async function initFeed() {
        for(let name in bfs) {
            const txt = await callAI(`ä½ æ˜¯${name}ï¼Œæ€§æ ¼${bfs[name].desc}ã€‚ç™¼ä¸€å‰‡æœ‹å‹åœˆçµ¦æŸ”æŸ”ã€‚`);
            renderPost(name, txt, false);
        }
    }

    function renderPost(name, txt, isMe) {
        const flow = document.getElementById('feed-flow');
        const card = document.createElement('div');
        card.className = 'post-card';
        card.innerHTML = `
            <div class="post-header" onclick="startChat('${name}')"><div class="avatar-sm" style="background-color:${bfs[name]?.color || '#f1b0b7'}"></div>${name}</div>
            <div style="font-size:14px;">${txt}</div>
            <div class="post-img-placeholder" onclick="triggerUpload(this)">é»æ“Šä¸Šå‚³åœ–</div>
            <div id="cmts-${Date.now()}" style="font-size:12px; margin-top:5px; color:#888;"></div>
        `;
        flow.prepend(card);
    }

    function startChat(name) { curChatBF = name; document.getElementById('chat-title').innerText = name; document.getElementById('msgBox').innerHTML = ''; showV('chat'); }
    
    async function askAI() {
        const inp = document.getElementById('userInput');
        const box = document.getElementById('msgBox');
        if(!inp.value) return;
        const m = inp.value; inp.value = '';
        box.innerHTML += `<div style="align-self:flex-end; background:var(--accent); color:white; padding:10px; border-radius:15px;">${m}</div>`;
        const ans = await callAI(`ä½ æ˜¯${curChatBF}ã€‚å›è¦†ï¼š${m}`);
        box.innerHTML += `<div style="align-self:flex-start; background:#eee; padding:10px; border-radius:15px;">${ans}</div>`;
        box.scrollTop = box.scrollHeight;
    }

    function showV(v) {
        document.querySelectorAll('.view').forEach(e => e.classList.remove('active'));
        document.querySelectorAll('nav span').forEach(e => e.classList.remove('active'));
        document.getElementById('v-'+v).classList.add('active');
        document.getElementById('n-'+v).classList.add('active');
    }

    let targetEl;
    function triggerUpload(el) { targetEl = el; document.getElementById('filePicker').click(); }
    document.getElementById('filePicker').onchange = function() {
        if(this.files[0]) {
            const r = new FileReader();
            r.onload = e => { targetEl.innerHTML = `<img src="${e.target.result}" style="width:100%;height:100%;object-fit:cover;border-radius:inherit;">`; };
            r.readAsDataURL(this.files[0]);
        }
    };

    setInterval(() => {
        const d = new Date();
        document.getElementById('island-time').innerText = d.getHours().toString().padStart(2,'0')+":"+d.getMinutes().toString().padStart(2,'0');
    }, 1000);

    initFeed();
</script>
</body>
</html>
